autonumber

actor 利用者
利用者 -> "Payment_View" : 管理画面を表示
"Payment_View" -> "PaymentsController" : index

利用者 ->> "Payment_View" : 内容入力フォームからフォーカスを外す
"Payment_View" -> "Api::DictionariesController" : index
"Api::DictionariesController" -> "Dictionary" : where

利用者 -> "Payment_View" : 登録ボタン押下
"Payment_View" -> "Api::PaymentsController" : create

alt 必須パラメーターがない
  autonumber stop
  "Payment_View" <-- "Api::PaymentsController"
  利用者 <-- "Payment_View"
end

autonumber resume
create Payment
"Api::PaymentsController" -> "Payment" : new

loop カテゴリの数だけ繰り返す
  "Api::PaymentsController" -> "Category" : find_or_create_by
end

"Api::PaymentsController" -> "Payment" : save

alt 登録に成功
  autonumber stop
  "Payment_View" <-- "Api::PaymentsController"

  autonumber resume
  "Payment_View" -> "Api::DictionariesController" : index

  alt 辞書が登録されていない
    "Payment_View" -> "Payment_View" : ダイアログを表示

    利用者 -> "Payment_View" : 登録ボタンを押下
    "Payment_View" -> "Api::DictionariesController" : create
  end

  "Payment_View" -> "PaymentsController" : index
else
  autonumber stop
  "Payment_View" <-- "Api::PaymentsController" : エラー表示
  利用者 <-- "Payment_View"
end
