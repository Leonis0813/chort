機能仕様
========

機能仕様では以下を定義する

- :ref:`alg-ext-resource`
- :ref:`alg-ext-ui`
- :ref:`alg-ext-api`

.. _alg-ext-resource:

リソース
--------

本システムでは以下のリソースを扱う

- :ref:`alg-ext-res-payment`
- :ref:`alg-ext-res-category`
- :ref:`alg-ext-res-dictionary`

.. _alg-ext-res-payment:

収支リソース
^^^^^^^^^^^^

所持金の増減を表す

.. csv-table::
   :header: "属性名", "型", "意味", "備考"
   :widths: 10, 20, 30, 40

   "ID", "自然数", "収支情報にユニークに設定された値", "- 半角数字
   - システムによって自動的に付与される
   - 変更不可"
   "種類", "文字列", "収入, 支出を表す文字列", "- 以下のいずれか

     - income
     - expense"
   "日付", "文字列", "所持金の増減があった日時", "- yyyy-mm-dd の形式"
   "内容", "文字列", "所持金の増減があった理由など", "- 任意の文字列"
   "カテゴリ", ":ref:`alg-ext-res-category` の配列", "カテゴリリソースの名前",
   "金額", "自然数", "所持金の増減量", "- 半角数字"

.. _alg-ext-res-category:

カテゴリリソース
^^^^^^^^^^^^^^^^

収支のカテゴリを表す

.. csv-table::
   :header: "属性名", "型", "意味", "備考"
   :widths: 10, 20, 30, 40

   "ID", "自然数", "カテゴリ情報にユニークに設定された値", "- 半角数字
   - システムによって自動的に付与される
   - 変更不可"
   "名前", "文字列", "費目（例：食費，水道光熱費）", "- 任意の文字列"
   "意味", "文字列", "どのような収支情報が分類されるかを表す", "- 任意の文字列"

.. _alg-ext-res-dictionary:

辞書リソース
^^^^^^^^^^^^

収支の辞書を表す． :ref:`alg-ext-res-payment` の内容がどういうカテゴリかをあらかじめ設定しておくことができる

.. csv-table::
   :header: "属性名", "型", "意味", "備考"
   :widths: 10, 20, 30, 40

   "ID", "自然数", "辞書情報にユニークに設定された値", "- 半角数字
   - システムによって自動的に付与される
   - 変更不可"
   "フレーズ", "文字列", "カテゴリを設定したいフレーズ", "- 任意の文字列"
   "条件", "文字列", "内容とカテゴリを紐付けるかどうかを決める条件", "- 以下のいずれか

     - equal: 完全一致するフレーズにカテゴリを設定する
     - include: 部分一致するフレーズにカテゴリを設定する"
   "カテゴリ", ":ref:`alg-ext-res-category` の配列", "カテゴリリソースの名前",

.. _alg-ext-ui:

ユーザーインターフェース
------------------------

利用者はブラウザから収支の登録や確認、統計情報の確認を行うことができる

- 収支の登録や検索，辞書の登録は管理画面で行う
- 統計情報の確認は統計画面で行う

管理画面
^^^^^^^^

.. image:: images/management.png
   :alt: 管理画面
   :scale: 35

- 画面の上部に管理画面と統計画面へのリンクが表示される
- 画面の左側には収支情報の登録や検索，辞書情報の登録フォームが表示される

  - タブでフォームを切り替えることができ，初期状態では収支情報の登録フォームが表示される

- 画面の右側には収支情報の一覧が表示される

フォーム共通仕様
""""""""""""""""

日付入力ボックス
''''''''''''''''

.. image:: images/ui_calendar.png
   :alt: カレンダー
   :scale: 50

- 日付入力ボックスをクリックするとカレンダーが表示される
- 日付を選択すると，テキストボックスに「yyyy-mm-dd」の形式で日付が入力される

カテゴリ選択ダイアログ
''''''''''''''''''''''

.. image:: images/ui_management_category.png
   :alt: カテゴリ一覧
   :scale: 25

- カテゴリ入力フォームの右側のボタンを押下すると，カテゴリの一覧が表示されたダイアログが表示される

    - 登録されている収支情報から抽出されたカテゴリが表示される
    - 「OK」ボタンを押下すると，テキストボックスに選択したカテゴリが入力される

      - 複数個選択した場合は，カンマ区切りで入力される

    - 「Cancel」ボタンを押下すると，ダイアログが閉じて管理画面に戻る

不正入力エラー
''''''''''''''

- 不正な入力があった場合は，下記のダイアログが表示される

  .. image:: images/ui_management_failure.png
     :scale: 50

登録フォーム仕様
""""""""""""""""

.. image:: images/management_create_payment.png
   :alt: 登録フォーム
   :scale: 50

- 日付，内容，カテゴリ，金額，種類を入力して登録ボタンを押下すると，フォームに入力した内容で収支情報が登録される

  - 入力項目は全て必須項目
  - カテゴリ入力フォームには最も使用頻度の高いものが入力された状態になっている

検索フォーム仕様
""""""""""""""""

.. image:: images/management_index_payments.png
   :alt: 検索フォーム
   :scale: 50

- 検索条件を入力して検索ボタンを押下すると，検索条件を満たす収支情報が一覧表示画面に表示される
- 日付入力フォームでは期間を指定する

  - どちらかを指定しなければ，それ以前，または以降の収支情報を全て取得する

- 内容入力フォームでは内容を指定する

  - 「を含む」を選択すると，指定した言葉を内容に含む収支情報を検索する
  - 「と一致する」を選択すると，指定した言葉と内容が完全一致する収支情報を検索する

- 金額入力フォームでは金額の範囲を指定する

  - どちらかを指定しなければ，それ以上，または以下の収支情報を全て取得する

- 種類選択フォームでは「収支」，「支出」を選択して特定の種類の収支情報のみを取得する

辞書登録フォーム仕様
""""""""""""""""""""

.. image:: images/management_create_dictionary.png
   :alt: 辞書登録フォーム
   :scale: 50

- フレーズとカテゴリを入力して登録ボタンを押下すると，入力したフレーズとカテゴリで辞書が登録される
- フレーズ入力フォームではフレーズを指定する

  - 「を含む」を選択すると，入力したフレーズを含む内容を入力した場合に指定したカテゴリを設定する
  - 「と一致する」を選択すると，入力したフレーズと一致する内容を入力した場合に指定したカテゴリを設定する

収支情報一覧画面仕様
""""""""""""""""""""

.. image:: images/ui_payment_list.png
   :scale: 50

- 収支情報はページングされており，全件数と下記ページへのリンクが表示されている

  - 先頭ページ
  - 最終ページ
  - 次ページ
  - 前ページ
  - 表示中のページから前後4ページ

- 最新の収支から順番に表示される

  - 表のヘッダの各セルの右側のボタンを押すと，収支情報がソートされる

- 1ページ50件の収支が表示される

  - テキストボックスに入力することで表示件数を指定可能
  - デフォルト: 50件

- 収支情報の右側にあるボタンを押すと、削除を確認するダイアログが表示される

  .. image:: images/ui_management_confirm.png
     :alt: 削除確認画面
     :scale: 50

  - 「はい」ボタンを押下すると対応する収支情報が削除される
  - 「いいえ」ボタンを押下すると削除せずに管理画面に戻る

- 内容，カテゴリが長い場合は省略される

統計画面
^^^^^^^^

.. image:: images/ui_statistics.png
   :alt: 統計画面

- 管理画面へ遷移するボタンと収支を表すグラフで構成される
- 月別の収支を表す棒グラフが3年間分表示される

  - マウスポインタを棒の上に置くと金額が表示される
  - 横軸のラベルをクリックするとその月の日別の収支のグラフが下に表示される

    - 日別の収支の棒グラフも同様に，マウスポインタを棒の上に置くと金額が表示される

.. _alg-ext-api:

Web API
-------

以下のAPIを定義する

.. toctree::
   :maxdepth: 1

   external/api/payment
   external/api/category
   external/api/dictionary

共通仕様
^^^^^^^^

.. _alg-ext-api-common-error:

リクエスト
""""""""""

- WebAPI のパスには全て先頭に ``/algieba/api`` を付与すること

  - 本API仕様書に記載されているパスは全て上記のパス以下を記載する

  - 例：収支を検索する場合

    .. sourcecode:: http

       GET /algieba/api/payments HTTP/1.1

エラーコード
""""""""""""

.. csv-table::
   :header: "エラーコード", "ステータスコード", "意味"

   "absent_param_[属性]", "400", "入力必須の項目がない"
   "invalid_param_[属性]", "400", "不正値のパラメータがある"
