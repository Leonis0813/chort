設計仕様
========

設計仕様では以下を定義する

- :ref:`adh-int-class`
- :ref:`adh-int-seq`

.. _adh-int-class:

モジュール構成
--------------

*クラス図*

.. uml:: umls/class.uml

- MVCモデルを利用する

- Model

  - データベースに登録するため本モジュールにはモデルは存在しない

- View

  - CreateView

    - MainActivityから渡される情報を表示するクラス
    - 下記のビューを含む

      - InputView

        - 入力項目を表す抽象クラス
        - 下記の４つのビューを抽象化している

          - DateView

            - 日付に関する情報を表示するビュー

          - ContentView

            - 内容に関する情報を表示するビュー

          - CategoryView

            - カテゴリに関する情報を表示するビュー

          - PriceView

            - 金額に関する情報を表示するビュー

  - IndexView

    - IndexActivityから渡される情報を表示するクラス
    - 下記のビューを含む

      - PeriodView

        - 期間に関する情報を表示するビュー

      - ContentView

        - 内容に関する情報を表示するビュー

      - CategoryView

        - カテゴリに関する情報を表示するビュー

      - PriceView

        - 金額に関する情報を表示するビュー

    - PaymentListAdapter

      - 収支情報の一覧を管理するクラス

- Controller

  - MainActivity

    - 収支登録画面を管理するクラス
    - 入力された情報の登録や収支、カテゴリの取得を行う

  - IndexActivity

    - 収支検索画面を管理するクラス
    - 入力された情報をもとに収支情報の検索やカテゴリの取得を行う

- InputChecker

  - 正しく入力されているかをチェックするクラス
  - 全項目が入力されているかをチェックする
  - 日付，金額が正しく入力されているかをチェックする

- HTTPClient

  - データベースサーバへアクセスし，以下を行うクラス

    - 収支情報の登録
    - 収支情報の検索
    - カテゴリ情報の検索
    - 辞書情報の検索
    - 統計情報の取得

.. _adh-int-seq:

シーケンス
----------

- :ref:`adh-int-seq-registration`
- :ref:`adh-int-seq-index`

.. _adh-int-seq-registration:

収支を登録する
^^^^^^^^^^^^^^

.. uml:: umls/seq-create.uml

1. 利用者がアプリを起動するとonCreateメソッドが実行される
2. 統計情報を取得する
3. 統計情報を取得するためにHTTPClientクラスのインスタンスを作成する
4. 統計情報を取得するための設定を行う
5. HTTPリクエストを送信してデータベースから統計情報を取得する
6. 取得した統計情報を表示する
7. カテゴリ情報を取得する
8. カテゴリ情報を取得するためにHTTPClientクラスのインスタンスを作成する
9. カテゴリ情報を取得するための設定を行う
10. HTTPリクエストを送信してデータベースからカテゴリ情報を取得する
11. カテゴリ情報を画面に設定する
12. カテゴリ情報ごとに選択されたかのフラグを初期化する
13. 内容を入力するとonFocusChangeメソッドが実行される
14. 辞書情報を検索する
15. 辞書情報を検索するためにHTTPClientクラスのインスタンスを作成する
16. 辞書情報を検索するための設定を行う
17. HTTPリクエストを送信してデータベースから辞書情報を取得する
18. 辞書情報からカテゴリを設定する
19. カテゴリの名前を画面に表示する
20. 利用者が登録ボタンを押下するとonClickメソッドが実行される
21. 収支情報を登録する
22. 入力が空の項目がないかチェックする

空の項目がある場合は24, 25を実行して終了する

23. 空の項目がある場合はエラーメッセージを表示する
24. さらに空の入力フォームにチェックマークを付ける

空の項目がない場合は以下を実行する

25. 入力された日付のフォーマットをチェックする
26. 入力された金額をチェックする

不正な入力がある場合は28, 29を実行して終了する

27. エラーメッセージを表示する
28. 不正な入力があるフォームにチェックマークを付ける

不正な入力がない場合は以下を実行する

29. 収支情報を作成するためのHTTPClientクラスのインスタンスを作成する
30. 収支情報を作成するための設定を行う
31. HTTPリクエストを送信してデータベースに収支情報を登録する
32. 収支情報が作成されたことを画面に表示する
33. 全ての入力フォームを空文字にする
34. 日付入力フォームにアプリ起動時の日付をセットする
35. 統計情報を取得する
36. 統計情報を取得するためにHTTPClientクラスのインスタンスを作成する
37. 統計情報を取得するための設定を行う
38. HTTPリクエストを送信してデータベースから統計情報を取得する
39. 取得した統計情報を表示する

.. _adh-int-seq-index:

収支を検索する
^^^^^^^^^^^^^^

.. uml:: umls/seq-index.uml

1. 利用者がメニューから「検索」を選択するとonCreateメソッドが実行される
2. アプリはgetCategoriesメソッドを実行してカテゴリ一覧を取得する
3. カテゴリ情報を取得するためにHTTPClientクラスのインスタンスを作成する
4. credentialメソッドを実行してWebAPIを利用するためのAuthorizationヘッダーをセットする
5. sendRequestメソッドを実行してWebAPIを実行し，カテゴリ情報を取得する
6. setCategoriesメソッドを実行してCategoryViewにカテゴリ情報をセットする
7. setCategoriesメソッドを実行してダイアログにカテゴリ名をセットする
8. 利用者が検索ボタンを押下するとonClickメソッドが実行される
9. searchPaymentsメソッドを実行して収支情報を検索する
10. 期間が入力されている場合，checkDateメソッドを実行して入力された日付のフォーマットをチェックする
11. 日付が不正な場合，showWrongInputメソッドを実行してチェックマークを付ける
12. 金額が入力されている場合，checkPriceメソッドを実行して入力された金額をチェックする
13. 金額が不正な場合，showWrongInputメソッドを実行してチェックマークを付ける
14. 不正な入力がある場合，showMessageメソッドを実行してエラーメッセージを表示する
15. 不正な入力がない場合，収支情報を検索するためのHTTPClientクラスのインスタンスを作成する
16. credentialメソッドを実行してWebAPIを利用するためのAuthorizationヘッダーをセットする
17. sendRequestメソッドを実行してWebAPIを実行し，収支情報を検索する
18. addPaymentsメソッドを実行して取得した収支情報を追加する
19. setAdapterメソッドを実行して追加した収支情報を画面に表示する
20. fixListViewHeightメソッドを実行して画面の高さを調整する
