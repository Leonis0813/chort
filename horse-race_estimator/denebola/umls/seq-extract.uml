autonumber

actor 利用者
利用者 -> Extractor : work!

Extractor -> ArgumentUtil : check_operation

create Extractor
Extractor -> Extractor : new

activate Extractor
  loop 指定された期間内を日付ごとに繰り返し
    extract -> File : read

    loop レースIDごとに繰り返し
      extract -> File : read
      extract -> "Nokogiri::HTML" : parse
      extract -> extract : update_race_info

      activate extract
        extract -> "extract/race" : extract_race
        extract -> Race : create_or_update!
      deactivate extract

      loop エントリーごとに繰り返し
        extract -> "extract/entry" : extract_entry
        extract -> extract : update_entry_info

        activate extract
          extract -> Entry : create_or_update!
        deactivate extract

        extract -> extract : update_jockey_info

        activate extract
          extract -> Jockey : create_or_update!
        deactivate extract

        alt エントリー情報と騎手情報の登録/更新に成功した
          extract -> Jockey : results
          activate Jockey
            Jockey -> Entry : <<
          deactivate Jockey
        end

        extract -> extract : update_horse_info

        activate extract
          extract -> File : read
          extract -> "Nokogiri::HTML" : parse
          extract -> "extract/horse" : extract_horse
          extract -> Horse : create_or_update!
        deactivate extract

        alt エントリー情報と競走馬情報の登録/更新に成功した
          extract -> Horse : results
          activate Horse
            Horse -> Entry : <<
          deactivate Horse
        end
      end

      extract -> "extract/payoff" : extract_payoff
      extract -> Race : create_or_update_payoff
    end
  end
deactivate extract
