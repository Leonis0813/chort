autonumber

loop 指定された期間内を日付ごとに繰り返し
  extract -> File : read
end

loop レースIDごとに繰り返し
  extract -> File : read
  extract -> "Nokogiri::HTML" : parse

  autonumber stop
  extract <-- "Nokogiri::HTML" : parsed_html

  autonumber resume
  extract -> "extract/race" : extract_race

  autonumber stop
  extract <-- "extract/race" : race_attribute

  autonumber resume
  extract -> Race : find_or_create_by!(race_attribute)

  autonumber stop
  extract <-- Race : race

  loop エントリーごとに繰り返し
    autonumber resume
    extract -> "extract/entry" : extract_entry

    autonumber stop
    extract -> "extract/entry" : entry_attribute

    autonumber resume
    extract -> Entry : find_or_create_by!(entry_attribute)

    autonumber stop
    extract <-- Entry : entry

    autonumber resume
    extract -> File : read
    extract -> "Nokogiri::HTML" : parse

    autonumber stop
    extract <-- "Nokogiri::HTML" : parsed_html

    autonumber resume
    extract -> "extract/horse" : extract_horse

    autonumber stop
    extract <-- "extract/horse" : horse_attribute

    autonumber resume
    extract -> Horse : find_or_create_by!(horse_attribute)
  end
end
