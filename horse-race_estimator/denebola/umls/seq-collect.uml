autonumber

actor 利用者
利用者 -> Collector : work!

activate Collector
  create collector
  Collector -> collector : new
  Collector -> collector : remove_empty_files

  loop 指定された期間内を日付ごとに繰り返し
    Collector -> collector : fetch_race_ids

    activate collector
      alt レースIDファイルが存在する
        collector -> File : read
      else
        collector -> NetkeibaClient : http_get_race_ids
        collector -> File : write
      end
    deactivate collector

    loop レースIDごとに繰り返し
      Collector -> collector : fetch_race

      activate collector
        alt レース情報ファイルが存在する
          collector -> File : read
        else
          collector -> NetkeibaClient : http_get_race
          collector -> File : write
        end
      deactivate collector

      Collector -> "Nokogiri::HTML" : parse

      loop レースのエントリーごとに繰り返し
        Collector -> collector : fetch_horse

        activate collector
          alt 競走馬情報ファイルが存在しない
            collector -> NetkeibaClient : http_get_horse
            collector -> File : write
          end
        deactivate collector
      end
    end
  end
deactivate Collector
