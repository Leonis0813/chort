機能仕様
========

機能仕様では以下を定義する

- :ref:`alt-ext-resource`
- :ref:`alt-ext-ui`

.. _alt-ext-resource:

リソース
--------

本システムでは以下のリソースを扱う

- :ref:`alt-ext-resource-analysis`
- :ref:`alt-ext-resource-prediction`
- :ref:`alt-ext-resource-evaluation`

.. _alt-ext-resource-analysis:

分析ジョブ
^^^^^^^^^^

分析の実行単位を表す．分析を1度実行すると1ジョブリソースが生成される

.. csv-table::
   :header: "属性名", "型", "意味", "備考"
   :widths: 20, 10, 30, 40

   "実行開始日時", "文字列(string)", "分析を開始した日時", "- 年/月/日 時:分:秒"
   "学習データ数", "自然数(integer)", "分析に利用したデータ数", "- 半角数字"
   "決定木の数", "自然数(integer)", "生成するランダムフォレストの木の数", "- 半角数字"
   "特徴量の数", "自然数(integer)", "分析に利用する特徴量の数", "- 半角数字
   - システム内部で自動的に決定される"
   "状態", "文字列(string)", "ジョブの状態", "- 以下のいずれか

     - 実行中
     - 完了"

.. _alt-ext-resource-prediction:

予測ジョブ
^^^^^^^^^^

予測の実行単位を表す．予測を1度実行すると1ジョブリソースが生成される

.. csv-table::
   :header: "属性名", "型", "意味", "備考"
   :widths: 20, 10, 30, 40

   "実行開始日時", "文字列(string)", "予測を開始した日時", "- 年/月/日 時:分:秒"
   "モデル", "文字列(string)", "入力されたモデルのファイル名",
   "テストデータ", "文字列(string)", "予測するレースデータのファイル名，またはURL",
   "状態", "文字列(string)", "ジョブの状態", "- 以下のいずれか

     - 実行中
     - 完了"

.. _alt-ext-resource-evaluation:

評価ジョブ
^^^^^^^^^^

評価の実行単位を表す．評価を1度実行すると1ジョブリソースが生成される

.. csv-table::
   :header: "属性名", "型", "意味", "備考"
   :widths: 20, 10,30, 40

   "実行開始日時", "文字列(string)", "予測を開始した日時", "- 年/月/日 時:分:秒"
   "モデル", "文字列(string)", "入力されたモデルのファイル名",
   "状態", "文字列(string)", "ジョブの状態", "- 以下のいずれか

     - 実行中
     - 完了"

.. _alt-ext-ui:

ユーザーインターフェース
------------------------

利用者はブラウザからレースの分析や予測を行う

- レースの分析は :ref:`alt-ext-ui-analysis` で行う
- レースの予測は :ref:`alt-ext-ui-prediction` で行う
- モデルの評価は :ref:`alt-ext-ui-evaluation` で行う

.. _alt-ext-ui-analysis:

分析画面
^^^^^^^^

.. image:: images/analysis.png
   :alt: 分析画面

- 画面左部にパラメーター入力フォームが表示される

  - 実行ボタンを押下すると分析が開始される

    - 入力フォームに不正な値（文字列，負数など）を入力すると以下のダイアログを表示して入力が間違っていることを通知する

      .. image:: images/analysis_failure.png
         :alt: エラーダイアログ
         :scale: 25

  - 分析が終了すると登録されているメールアドレスに完了を通知するメールが送信される

    - メール本文には以下の情報が記載されている

      - 分析開始日時
      - 分析完了日時
      - 以下のパラメーター

        - 学習データ数
        - 決定木の数
        - 特徴量の数

    - メールには圧縮ファイルが添付されており以下のファイルが含まれている

      - レース予測モデル
      - 分析に使用したデータ

- 画面右部に実行したジョブ情報の一覧が表示される

  - 25ジョブごとにページングされている
  - 実行開始日時の降順でソートされている
  - 実行中のジョブは黄色，完了したジョブの行は緑色で表示される
  - ジョブ情報の右側のボタンを押下すると，そのジョブと同じパラメーターで分析を実行する

.. _alt-ext-ui-prediction:

予測画面
^^^^^^^^

.. image:: images/prediction.png
   :alt: 予測画面

- 画面左部にデータ入力フォームが表示される

  - フォーム上部の「こちら」を押下すると，レースデータが登録されている外部サイトへアクセスする

    - 外部サイトは別タブで表示される

  - モデルには分析を実行して受け取った圧縮ファイルに含まれている予測モデルを指定する
  - テストデータにはファイルを指定するか，データが表示されているサイトのURLを指定できる
  - 実行ボタンを押下すると予測が開始される
  - 予測が終了すると登録されているメールアドレスに完了を通知するメールが送信される

    - メール本文には以下の情報が記載されている

      - 予測開始日時
      - 予測完了日時
      - モデルファイル名
      - テストデータソース（ファイル名，またはURL）

    - メールには圧縮ファイルが添付されており以下のファイルが含まれている

      - 予測結果が記載されたファイル

- 画面右部に実行したジョブ情報の一覧が表示される

  - 25ジョブごとにページングされている
  - 実行開始日時の降順でソートされている
  - 実行中のジョブは黄色，完了したジョブの行は緑色で表示される
  - テストデータがサイトのURLの場合はクリックすると別タブにそのページが表示される

.. _alt-ext-ui-evaluation:

評価画面
^^^^^^^^

.. image:: images/evaluation.png
   :alt: 評価画面

- 画面左部にデータ入力フォームが表示される

  - モデルには分析を実行して受け取った圧縮ファイルに含まれている予測モデルを指定する
  - 実行ボタンを押下すると予測が開始される
  - 評価が終了すると登録されているメールアドレスに完了を通知するメールが送信される

    - メール本文には以下の情報が記載されている

      - 評価開始日時
      - 評価完了日時
      - モデルファイル名

    - メールには圧縮ファイルが添付されており以下のファイルが含まれている

      - 評価結果が記載されたファイル

- 画面右部に実行したジョブ情報の一覧が表示される

  - 25ジョブごとにページングされている
  - 実行開始日時の降順でソートされている
  - 実行中のジョブは黄色，完了したジョブの行は緑色で表示される
