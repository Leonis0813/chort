autonumber

actor 利用者
利用者 -> EvaluationView : 実行ボタン押下
EvaluationView -> EvaluationsController : execute

create Evaluation
EvaluationsController -> Evaluation : new
EvaluationsController --> EvaluationJob : perform_later

autonumber stop
EvaluationView <- EvaluationsController
利用者 <- EvaluationView

autonumber resume
EvaluationJob -> NetkeibaClient : http_get_race_top

autonumber stop
EvaluationJob <-- NetkeibaClient

loop レースIDごとに繰り返し
  autonumber resume
  EvaluationJob -> NetkeibaClient : http_get_race

  autonumber stop
  EvaluationJob <-- NetkeibaClient

  loop レースのエントリーの数だけ繰り返す
    autonumber resume
    EvaluationJob -> NetkeibaClient : http_get_horse

    autonumber stop
    EvaluationJob <-- NetkeibaClient
  end

  autonumber resume
  EvaluationJob -> YAML : dump
end

EvaluationJob -> Evaluation : update

autonumber stop
EvaluationJob <-- Evaluation

autonumber resume
EvaluationJob -> EvaluationMailer : finished

autonumber stop
EvaluationMailer --> 利用者 : メール通知
