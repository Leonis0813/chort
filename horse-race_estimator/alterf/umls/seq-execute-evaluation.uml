autonumber

actor 利用者
利用者 -> EvaluationView : 実行ボタン押下
EvaluationView -> EvaluationsController : execute

create Evaluation
EvaluationsController -> Evaluation : new
EvaluationsController -> Evaluation : save
EvaluationsController ->> EvaluationJob : perform_later

autonumber stop
EvaluationView <-- EvaluationsController
利用者 <-- EvaluationView

autonumber resume
EvaluationJob -> Evaluation : find
EvaluationJob -> Evaluation : fetch_data

alt Top20 を選択
  Evaluation -> NetkeibaClient : http_get_race_top
else
  Evaluation -> File : read
end

loop レースIDごとに繰り返し
  EvaluationJob -> FeatureUtil : create_feature
  FeatureUtil -> "Denebola::Feature" : where
  EvaluationJob -> NetkeibaClient : http_get_race_name
  EvaluationJob -> "Evaluation::Datum" : create!
  EvaluationJob -> YAML : dump
  EvaluationJob -> "Evaluation::Datum" : import_prediction_results

  loop レースのエントリーの数だけ繰り返す
    "Evaluation::Datum" -> "Prediction::Result" : create!
  end
end

EvaluationJob -> Evaluation : calculate_precision!
EvaluationJob -> Evaluation : update!
