autonumber

actor 利用者
利用者 -> PredictionView : 実行ボタン押下
PredictionView -> PredictionsController : execute

create Prediction
PredictionsController -> Prediction : new
PredictionsController --> PredictionJob : perform_later

autonumber stop
PredictionView <- PredictionsController
利用者 <- PredictionView

alt URL指定
  autonumber resume
  PredictionJob -> NetkeibaClient : http_get_race

  autonumber stop
  PredictionJob <-- NetkeibaClient

  loop レースのエントリーの数だけ繰り返す
    autonumber resume
    PredictionJob -> NetkeibaClient : http_get_horse

    autonumber stop
    PredictionJob <-- NetkeibaClient
  end

  autonumber resume
  PredictionJob -> YAML : dump
end

loop レースのエントリーの数だけ繰り返す
  alt 1着と予測された
    PredictionJob -> "Prediction::Result" : create
  end
end

PredictionJob -> Prediction : update

autonumber stop
PredictionJob <-- Prediction
