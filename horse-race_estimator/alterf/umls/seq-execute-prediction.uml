autonumber

actor 利用者
利用者 -> PredictionView : 実行ボタン押下

activate PredictionView
  PredictionView -> PredictionsController : execute

  activate PredictionsController
    create Prediction
    PredictionsController -> Prediction : new
    PredictionsController ->> PredictionJob : perform_later
    activate PredictionJob

    autonumber stop
    PredictionView <-- PredictionsController
  deactivate PredictionsController

  利用者 <-- PredictionView
deactivate PredictionView

alt URL指定
  autonumber resume
  PredictionJob -> NetkeibaClient : http_get_race

  loop レースのエントリーの数だけ繰り返す
    PredictionJob -> NetkeibaClient : http_get_horse
  end

  PredictionJob -> YAML : dump
end

alt モデルのエントリー数と等しい
  PredictionJob -> ApplicationJob : execute_script

  loop レースのエントリーの数だけ繰り返す
    PredictionJob -> "Prediction::Result" : create!
  end

  PredictionJob -> Prediction : update!
else
  PredictionJob -> Prediction : update!
end
deactivate PredictionJob
