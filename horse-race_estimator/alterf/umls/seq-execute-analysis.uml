autonumber

actor 利用者
利用者 -> AnalysisView : 実行ボタン押下

activate AnalysisView
  AnalysisView -> AnalysesController : execute

  activate AnalysesController
    AnalysesController -> AnalysesController : remove_old_files
    AnalysesController -> AnalysesController : check_absent_param

    create Analysis
    AnalysesController -> Analysis : new

    activate Analysis
      create AnalysisResult
      Analysis -> AnalysisResult : new
    deactivate Analysis

    AnalysesController ->> AnalysisJob : perform_later
    activate AnalysisJob

    autonumber stop
    AnalysisView <-- AnalysesController
  deactivate AnalysesController

  利用者 <-- AnalysisView : ジョブ登録完了通知
deactivate AnalysisView

autonumber resume
AnalysisJob -> Analysis : find
AnalysisJob -> AnalysisJob : execute_script
AnalysisJob -> YAML : load_file
AnalysisJob -> Analysis : update
AnalysisJob -> Analysis : result
AnalysisJob -> AnalysisResult : importances

activate AnalysisResult
  loop 素性の数だけ繰り返し
    create Importance
    AnalysisResult -> Importance : new
  end
deactivate AnalysisResult

AnalysisJob -> YAML : dump
AnalysisJob -> AnalysisMailer : completed

activate AnalysisMailer
  autonumber stop
  利用者 <-- AnalysisMailer : メール通知
deactivate AnalysisMailer

autonumber resume
AnalysisJob -> Analysis : update
deactivate AnalysisJob
