設計仕様
========

設計仕様では以下を定義する

- :ref:`zos-int-cls`
- :ref:`zos-int-seq`
- :ref:`zos-int-sch`

.. _zos-int-cls:

モジュール構成
--------------

*クラス図*

.. uml:: umls/class.uml

- Rate

  - レートを表すクラス

.. _zos-int-seq:

シーケンス
----------

- :ref:`zos-int-seq-import`

.. _zos-int-seq-import:

レートを取得する
^^^^^^^^^^^^^^^^

*シーケンス図*

.. uml:: umls/seq-import.uml

1. 外部ツールからレートが書かれたファイルを取得する

   - 外部ツールのレートはリアルタイムで日付・ペアごとにファイル出力されている
   - 1行に1レートが日時の順番で記載されている

取得したファイル数分，2, 3を繰り返す

2. ファイルに記載されているレート情報を成形して一時ファイルに書き込む
3. 書き込んだ一時ファイルをDBにインポートする
4. DBから日時を指定してレートを取得する

レートが存在していれば5を実行する

5. DBに登録したレートをファイルに出力する

   - 1日分の全てのペアのレートを日時の順番で1ファイルに出力する
   - 一致していなければエラーを発生させる

.. _zos-int-sch:

スキーマ定義
------------

- :ref:`zos-int-sch-rates`

.. _zos-int-sch-rates:

ratesテーブル
^^^^^^^^^^^^^

レートを登録するratesテーブルを定義する

.. csv-table::
   :header: "カラム", "型", "内容", "PRIMARY KEY", "NOT NULL"
   :widths: 10, 10, 20, 20, 10

   "id", "INTEGER", "レートのID", "◯", "◯"
   "time", "DATETIME", "レートが変化した日時",, "◯"
   "pair", "STRING", "レートのペア",, "◯"
   "bid", "FLOAT", "売値",, "◯"
   "ask", "FLOAT", "買値",, "◯"
